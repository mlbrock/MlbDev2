// ////////////////////////////////////////////////////////////////////////////
// ////////////////////////////////////////////////////////////////////////////
// MLB NatsWrapper Library Module File
// ////////////////////////////////////////////////////////////////////////////
/*
   File Name         :  NatsExceptionStatus.cpp

   File Description  :  Implementation of the NatsExceptionStatus class.

   Revision History  :  2024-09-10 --- Creation.
                           Michael L. Brock

      Copyright Michael L. Brock 2024.
      Distributed under the Boost Software License, Version 1.0.
      (See accompanying file LICENSE_1_0.txt or copy at
      http://www.boost.org/LICENSE_1_0.txt)

*/
// ////////////////////////////////////////////////////////////////////////////

// ////////////////////////////////////////////////////////////////////////////
// ////////////////////////////////////////////////////////////////////////////
// Required include files...
// ////////////////////////////////////////////////////////////////////////////

#include <NatsWrapper/NatsExceptionStatus.hpp>

#include <NatsWrapper/NatsStatus.hpp>

// ////////////////////////////////////////////////////////////////////////////

namespace MLB {

namespace NatsWrapper {

// ////////////////////////////////////////////////////////////////////////////
NatsExceptionStatus::NatsExceptionStatus()
	:std::runtime_error("")
	,nats_code_(NATS_OK)
{
}
// ////////////////////////////////////////////////////////////////////////////

// ////////////////////////////////////////////////////////////////////////////
NatsExceptionStatus::NatsExceptionStatus(const std::string &error_text)
	:std::runtime_error(error_text)
	,nats_code_(NATS_OK)
{
}
// ////////////////////////////////////////////////////////////////////////////

// ////////////////////////////////////////////////////////////////////////////
NatsExceptionStatus::NatsExceptionStatus(natsStatus nats_code,
	const char *func_name, const char *params)
	:std::runtime_error(GetStatusString(nats_code, func_name, params))
	,nats_code_(nats_code)
{
}
// ////////////////////////////////////////////////////////////////////////////

// ////////////////////////////////////////////////////////////////////////////
NatsExceptionStatus::NatsExceptionStatus(const std::string &src_text,
	natsStatus nats_code)
	:std::runtime_error(GetStatusString(src_text, nats_code))
	,nats_code_(nats_code)
{
}
// ////////////////////////////////////////////////////////////////////////////

// ////////////////////////////////////////////////////////////////////////////
NatsExceptionStatus::~NatsExceptionStatus()
{
}
// ////////////////////////////////////////////////////////////////////////////

// ////////////////////////////////////////////////////////////////////////////
natsStatus NatsExceptionStatus::GetNatsStatus() const
{
	return(nats_code_);
}
// ////////////////////////////////////////////////////////////////////////////

// ////////////////////////////////////////////////////////////////////////////
std::string NatsExceptionStatus::GetStatusString(natsStatus nats_code,
	const char *func_name, const char *params)
{
	std::string tmp_string("Error was encountered in function " +
		std::string(func_name) + ((params && *params) ? params : "()"));

	return(GetStatusString(tmp_string, nats_code));
}
// ////////////////////////////////////////////////////////////////////////////

// ////////////////////////////////////////////////////////////////////////////
std::string NatsExceptionStatus::GetStatusString(const std::string &src_text,
	natsStatus nats_code)
{
	std::string status_string(((!src_text.empty()) ? src_text :
		std::string("Unspecified error occurred")) + ": NATS error code " +
		std::to_string(nats_code) + " (" +
		std::string(GetNatsStatusText(nats_code)) + ").");

	return(status_string);
}
// ////////////////////////////////////////////////////////////////////////////

} // namespace NatsWrapper

} // namespace MLB

// ////////////////////////////////////////////////////////////////////////////
// ****************************************************************************
// ****************************************************************************
// ****************************************************************************
// ////////////////////////////////////////////////////////////////////////////

#ifdef TEST_MAIN

#include <iomanip>
#include <iostream>

namespace {

// ////////////////////////////////////////////////////////////////////////////
void TEST_NatsExceptionStatus()
{
	using namespace MLB::NatsWrapper;

	for (int nats_code = -1; nats_code < 100; ++nats_code) {
		try {
			throw NatsExceptionStatus(
				std::string("Test natsStatus = ") + std::to_string(nats_code),
				static_cast<natsStatus>(nats_code));
		}
		catch (const std::exception &except) {
			std::cout << "RESULTS FOR NATS CODE = " << std::setw(3) <<
				nats_code << ": " << except.what() << '\n';
		}
	}

	std::cout << "*** MIN natsStatus=" << GetNatsStatusMin()
		<< " ---> MAX natsStatus=" << GetNatsStatusMax() << std::endl;
}
// ////////////////////////////////////////////////////////////////////////////

} // Anonymous namespace

// ////////////////////////////////////////////////////////////////////////////
int main()
{
	int return_code = EXIT_SUCCESS;

	try {
		TEST_NatsExceptionStatus();
	}
	catch (const std::exception &except) {
		return_code = EXIT_FAILURE;
		std::cerr << "\n\nERROR: " << except.what() << std::endl;
	}

	return(return_code);
}
// ////////////////////////////////////////////////////////////////////////////

#endif // #ifdef TEST_MAIN

