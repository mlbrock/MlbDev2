// ////////////////////////////////////////////////////////////////////////////
// ////////////////////////////////////////////////////////////////////////////
// MLB NatsWrapper Library Module File
// ////////////////////////////////////////////////////////////////////////////
/*
   File Name         :  NatsInbox.cpp

   File Description  :  Implementation of the NatsInbox class.

   Revision History  :  2024-09-16 --- Creation.
                           Michael L. Brock

      Copyright Michael L. Brock 2024.
      Distributed under the Boost Software License, Version 1.0.
      (See accompanying file LICENSE_1_0.txt or copy at
      http://www.boost.org/LICENSE_1_0.txt)

*/
// ////////////////////////////////////////////////////////////////////////////

// ////////////////////////////////////////////////////////////////////////////
// ////////////////////////////////////////////////////////////////////////////
// Required include files...
// ////////////////////////////////////////////////////////////////////////////

#include <NatsWrapper/NatsInbox.hpp>

// ////////////////////////////////////////////////////////////////////////////

namespace MLB {

namespace NatsWrapper {

// ////////////////////////////////////////////////////////////////////////////
// PRIVATE: Accessible to NatsSubscription::NextMessage()
NatsInbox::NatsInbox()
	:nats_inbox_sptr_()
{
	natsInbox *nats_inbox = NULL;

	NatsWrapper_THROW_IF_NOT_OK(::natsInbox_Create,
		(&nats_inbox))

	nats_inbox_sptr_.reset(nats_inbox, ::natsInbox_Destroy);
}
// ////////////////////////////////////////////////////////////////////////////

// ////////////////////////////////////////////////////////////////////////////
NatsInbox::~NatsInbox()
{
}
// ////////////////////////////////////////////////////////////////////////////

// ////////////////////////////////////////////////////////////////////////////
natsInbox *NatsInbox::GetPtr()
{
	return(nats_inbox_sptr_.get());
}
// ////////////////////////////////////////////////////////////////////////////

// ////////////////////////////////////////////////////////////////////////////
const natsInbox *NatsInbox::GetPtr() const
{
	return(nats_inbox_sptr_.get());
}
// ////////////////////////////////////////////////////////////////////////////

namespace {

// ////////////////////////////////////////////////////////////////////////////
const natsInbox *GetPtrChecked_Helper(const natsInbox *nats_inbox_ptr)
{
	if (!nats_inbox_ptr)
		throw std::runtime_error("Attempt to make use of the underlying NATS "
			"inbox pointer, but it is NULL.");

	return(nats_inbox_ptr);
}
// ////////////////////////////////////////////////////////////////////////////

} // Anonymous namespace

// ////////////////////////////////////////////////////////////////////////////
std::string NatsInbox::GetInboxAsString() const
{
	GetPtrChecked_Helper(nats_inbox_sptr_.get());

	return(std::string(nats_inbox_sptr_.get()));
}
// ////////////////////////////////////////////////////////////////////////////

// ////////////////////////////////////////////////////////////////////////////
std::string_view NatsInbox::GetInboxAsStringView() const
{
	GetPtrChecked_Helper(nats_inbox_sptr_.get());

	return(std::string_view(nats_inbox_sptr_.get()));
}
// ////////////////////////////////////////////////////////////////////////////

} // namespace NatsWrapper

} // namespace MLB

